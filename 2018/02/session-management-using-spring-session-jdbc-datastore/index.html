<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    
    
    <div class="analytics">
        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-71296890-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </div>
    
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" property="title" content="SivaLabs - Session Management using Spring Session with JDBC DataStore">
    <meta name="description" property="description" content="Java, Spring, SpringBoot, SpringCloud, JPA, Hibernate, DevOps, MicroServices, Docker tutorials - " >
    <title>SivaLabs - Session Management using Spring Session with JDBC DataStore </title>
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sivalabs.github.io/images/SpringSession.png"/>

<meta name="twitter:title" content="Session Management using Spring Session with JDBC DataStore"/>
<meta name="twitter:description" content="In web applications, user session management is very crucial for managing user state. In this article, we are going to learn about what are the approaches we have been following to manage user sessions in a clustered environment and how we can use Spring Session to implement it in a much simpler and more scalable way.
Typically in production environments, we will have multiple server nodes with a load balancer in front of them and all the client traffic will be coming through the load balancer to one of the server nodes."/>
<meta name="twitter:site" content="@sivalabs"/>

    <meta name="twitter:creator" content="@sivalabs"/>
    <meta property="og:title" content="Session Management using Spring Session with JDBC DataStore" />
<meta property="og:description" content="In web applications, user session management is very crucial for managing user state. In this article, we are going to learn about what are the approaches we have been following to manage user sessions in a clustered environment and how we can use Spring Session to implement it in a much simpler and more scalable way.
Typically in production environments, we will have multiple server nodes with a load balancer in front of them and all the client traffic will be coming through the load balancer to one of the server nodes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sivalabs.github.io/2018/02/session-management-using-spring-session-jdbc-datastore/" />

<meta property="og:image" content="https://sivalabs.github.io/images/SpringSession.png" />
<meta property="article:published_time" content="2018-02-07T07:59:17&#43;05:30"/>
<meta property="article:modified_time" content="2018-02-07T07:59:17&#43;05:30"/>

    
<meta itemprop="name" content="Session Management using Spring Session with JDBC DataStore">
<meta itemprop="description" content="In web applications, user session management is very crucial for managing user state. In this article, we are going to learn about what are the approaches we have been following to manage user sessions in a clustered environment and how we can use Spring Session to implement it in a much simpler and more scalable way.
Typically in production environments, we will have multiple server nodes with a load balancer in front of them and all the client traffic will be coming through the load balancer to one of the server nodes.">


<meta itemprop="datePublished" content="2018-02-07T07:59:17&#43;05:30" />
<meta itemprop="dateModified" content="2018-02-07T07:59:17&#43;05:30" />
<meta itemprop="wordCount" content="1287">

  <meta itemprop="image" content="https://sivalabs.github.io/images/SpringSession.png">



<meta itemprop="keywords" content="springboot,springsession," />


    <link rel='stylesheet' href="/assets/css/custom-fonts.css" type='text/css' media='all'/>

    <link rel='stylesheet' href="/assets/css/style.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/genericons.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/font-awesome.min.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/socicon.css" type='text/css' media='all'/>
    <link rel="stylesheet" href="/assets/css/social-logos/social-logos.css" type="text/css" media="all">
    <link rel='stylesheet' href="/assets/css/jetpack.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/custom-styles.css" type='text/css' media='all'/>

    <script type='text/javascript' src="/assets/js/jquery-1.12.4.min.js"></script>
    <script type='text/javascript' src="/assets/js/html5shiv.min.js"></script>
    <script type='text/javascript' src="/assets/js/navigation.js"></script>

    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />

    

</head>
<body class="home blog logged-in admin-bar no-customize-support post-layout-one-column">
    <div id="header-top" class="header-bar-wrap"></div>
    <div id="page" class="hfeed site">
        <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
        <header id="masthead" class="site-header clearfix" role="banner">
    <div class="header-main container clearfix">
        <div id="logo" class="site-branding clearfix">
            <h1 class="site-title">
                <a href="/" title="SivaLabs" rel="home">SivaLabs</a>
            </h1>
            <p class="site-description">My Experiments on Technology</p>
        </div>
        <div class="header-widgets clearfix">
        </div>
    </div>
    <div id="main-navigation-wrap" class="primary-navigation-wrap">
        <nav id="main-navigation" class="primary-navigation navigation container clearfix" role="navigation">
            <ul id="menu-home" class="main-navigation-menu">
                <li id="menu-item-1145" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-1145">
                    <a href="/">Home</a>
                </li>
                <li id="menu-item-1421" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1421">
                    <a href="/categories/java">Java</a>
                </li>
                <li id="menu-item-1423" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-1423">
                    <a href="/categories/spring">Spring</a>
                    <ul class="sub-menu">
                        <li id="menu-item-1424" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1424">
                            <a href="/categories/springboot">Spring Boot</a>
                        </li>
                        <li id="menu-item-1425" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1425">
                            <a href="/categories/springcloud">Spring Cloud</a>
                        </li>
                    </ul>
                </li>
                <li id="menu-item-1422" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1422">
                    <a href="/categories/microservices">MicroServices</a>
                </li>
                <li id="menu-item-1151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1151">
                    <a href="/videos">Videos</a>
                </li>
                <li id="menu-item-1161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1161">
                    <a href="/mybooks">My Books</a>
                </li>
                <li id="menu-item-1171" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1171">
                    <a href="/projects">My Projects</a>
                </li>
                <li id="menu-item-1146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1146">
                    <a href="/contact">Contact</a>
                </li>
            </ul>
        </nav>
    </div>
</header>
        <div id="content" class="site-content container clearfix">
            <section id="primary" class="content-archive content-area">
                
<main id="main" class="site-main" role="main">
<article class="post type-post status-publish format-standard hentry">
    <div class="post-inner-content">
        <header class="entry-header">
    <div class="entry-meta">
        <span class="meta-date">
            <a href="https://sivalabs.github.io/2018/02/session-management-using-spring-session-jdbc-datastore/" rel="bookmark">
                <time class="entry-date published" datetime="2018-02-07T07:59:17">
                February 07, 2018
                </time>
            </a>
        </span>
        <span class="meta-author">
            <span class="author vcard">Siva</span>
        </span>
    </div>
    <h2 class="entry-title">
        <a href="https://sivalabs.github.io/2018/02/session-management-using-spring-session-jdbc-datastore/" rel="bookmark">
            Session Management using Spring Session with JDBC DataStore
        </a>
    </h2>
    <div>
        
        
        
        <span class="tagcloud post-tags">
            <i class="fa fa-tags"></i>
            
            <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springboot/">springboot</a>
            &nbsp;
            
            <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springsession/">springsession</a>
            
            
        </span>
        
        
    </div>
</header>

        <div class="entry-content">
            

<p>In web applications, user session management is very crucial for managing user state. In this article, we are going to learn about what are the approaches we have been following to manage user sessions in a clustered environment and how we can use Spring Session to implement it in a much simpler and more scalable way.</p>

<p>Typically in production environments, we will have multiple server nodes with a load balancer in front of them and all the client traffic will be coming through the load balancer to one of the server nodes. So we need some mechanism to make the user session data available to each client in a clustered environment.</p>

<p>Traditionally we have been using the following techniques to manage sessions:</p>

<ol>
<li>Single Node Server</li>
<li>Multi-Node Server with Load Balancer and Sticky sessions</li>
<li>Multi-Node Server with Load Balancer and Session Replication</li>
<li>Multi-Node Server with Load Balancer and Session Data in a Persistent DataStore</li>
</ol>

<p>Let us briefly look at these approaches.</p>

<h2 id="1-single-node-server">1. Single Node Server</h2>

<p>If your application is not a critical service to your business, there won’t be too many users concurrently and some downtime is accepted then we can have Single Node Server deployment as shown below:</p>

<p><img src="/images/SingleNode-Sessions.jpg" alt="Single Node Sessions" title="Single Node Sessions" /></p>

<p>In this model, for each browser client, a session object is created on the server (HttpSession in case of Java) and SESSION_ID will be set as a cookie on the browser to identify the session object. But this Single Server Node deployment is not acceptable for most of the applications because if the server goes down the service will be down altogether.</p>

<h2 id="2-multi-node-server-with-sticky-sessions">2. Multi-Node Server with Sticky Sessions</h2>

<p>In order to make our application highly available and cater more number of users, we can have multiple server nodes behind a load balancer. In the Sticky Sessions approach, we configure our load balancer to route all the requests from the same client to the same node.</p>

<p><img src="/images/MultiNode-StickySessions.jpg" alt="Multi-Node Server with Sticky Sessions" title="Multi-Node Server with Sticky Sessions" /></p>

<p>In this model, the user session will be created on any one of the server node and all the further requests from that client will be sent to that same node. But the problem with this approach is if a server node goes down then all the user sessions on that server is gone.</p>

<h2 id="3-multi-node-server-with-session-replication">3. Multi-Node Server with Session Replication</h2>

<p>In this model, the user session data will be replicated on all the server nodes so that any request can be routed to any server node. Even if one node goes down the client request can be served by another node.</p>

<p><img src="/images/MultiNode-SessionReplication.jpg" alt="Multi-Node Server with SessionReplication" title="Multi-Node Server with SessionReplication" /></p>

<p>But the Session Replication requires better hardware support and involves some server specific configuration.</p>

<h2 id="4-multi-node-server-with-session-data-in-a-persistent-datastore">4. Multi-Node Server with Session Data in a Persistent DataStore</h2>

<p>In this model, the user session data will not be held in server’s memory, instead, it will be persisted into a data store and associate it with SESSION_ID.</p>

<p><img src="/images/MultiNode-SpringSession.jpg" alt="Multi-Node Server with Spring Session" title="Multi-Node Server with Spring Session" /></p>

<p>This solution will be server independent but we may need to write custom code to transparently store the session data in a Persistent datastore whenever a user adds some information to his/her session.
This is where Spring Session comes into the picture.</p>

<h2 id="spring-session">Spring Session</h2>

<p><a href="https://projects.spring.io/spring-session/">Spring Session</a> is an implementation of approach 4, which is Storing session data in a persistent datastore.
Spring Session supports multiple datastores like RDBMS, Redis, HazelCast, MongoDB etc to transparently save use session data.
As usual, using Spring Session with Spring Boot is as simple as adding a dependency and configuring few properties.
Let us see how we can use Spring Session with JDBC backend store in a Spring Boot application.</p>

<blockquote>
<p>You can find the source code for this article at <a href="https://github.com/sivaprasadreddy/spring-session-samples">https://github.com/sivaprasadreddy/spring-session-samples</a></p>
</blockquote>

<h3 id="step-1-create-spring-boot-application">Step 1: Create Spring Boot application</h3>

<p>Create a SpringBoot application using the latest version (it is 2.0.0.RC1 as of writing) with <strong>Web, Thymeleaf, JPA, H2, Session</strong> starters.</p>

<p>By default Session starter will add <strong>org.springframework.session:spring-session-core</strong> dependency,
let us change it to <strong>spring-session-jdbc</strong> as we are going to use JDBC backend.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.session<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-session-jdbc<span style="color:#f92672">&lt;/artifactId&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span></code></pre></div>

<h3 id="step-2-configure-spring-session-properties">Step 2: Configure Spring Session properties</h3>

<p>We can configure type of Spring Session backend data-store using <strong>spring.session.store-type</strong> property in application.properties.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-properties" data-lang="properties">spring.session.store-type=jdbc</code></pre></div>

<p>As we are using the H2 In-Memory database, Spring Session creates the following tables required to store session data automatically
from the script <strong>spring-session-jdbc-2.0.1.RELEASE.jar!/org/springframework/session/jdbc/schema-h2.sql</strong>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> SPRING_SESSION (
  PRIMARY_ID CHAR(<span style="color:#ae81ff">36</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  SESSION_ID CHAR(<span style="color:#ae81ff">36</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  CREATION_TIME BIGINT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  LAST_ACCESS_TIME BIGINT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  MAX_INACTIVE_INTERVAL INT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  EXPIRY_TIME BIGINT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  PRINCIPAL_NAME VARCHAR(<span style="color:#ae81ff">100</span>),
  <span style="color:#66d9ef">CONSTRAINT</span> SPRING_SESSION_PK <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (PRIMARY_ID)
);
 
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">INDEX</span> SPRING_SESSION_IX1 <span style="color:#66d9ef">ON</span> SPRING_SESSION (SESSION_ID);
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> SPRING_SESSION_IX2 <span style="color:#66d9ef">ON</span> SPRING_SESSION (EXPIRY_TIME);
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> SPRING_SESSION_IX3 <span style="color:#66d9ef">ON</span> SPRING_SESSION (PRINCIPAL_NAME);
 
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> SPRING_SESSION_ATTRIBUTES (
  SESSION_PRIMARY_ID CHAR(<span style="color:#ae81ff">36</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  ATTRIBUTE_NAME VARCHAR(<span style="color:#ae81ff">200</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  ATTRIBUTE_BYTES LONGVARBINARY <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#66d9ef">CONSTRAINT</span> SPRING_SESSION_ATTRIBUTES_PK <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (SESSION_PRIMARY_ID, ATTRIBUTE_NAME),
  <span style="color:#66d9ef">CONSTRAINT</span> SPRING_SESSION_ATTRIBUTES_FK <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (SESSION_PRIMARY_ID) <span style="color:#66d9ef">REFERENCES</span> SPRING_SESSION(PRIMARY_ID) <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">CASCADE</span>
);
 
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> SPRING_SESSION_ATTRIBUTES_IX1 <span style="color:#66d9ef">ON</span> SPRING_SESSION_ATTRIBUTES (SESSION_PRIMARY_ID);</code></pre></div>

<p>But if we are going to use other RDBMS like MySQL we can configure as follows:</p>

<p>Add MySQL maven dependency.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>mysql<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#f92672">&lt;/artifactId&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span></code></pre></div>

<p>Configure datasource properties for MySQL:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-properties" data-lang="properties">spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/demo
spring.datasource.username=root
spring.datasource.password=admin</code></pre></div>

<p>With this property, Spring Session will try to create tables using the script
<strong>classpath:org/springframework/session/jdbc/schema-@@platform@@.sql</strong>, so in our case, it will use <strong>schema-mysql.sql</strong>.</p>

<h3 id="step-3-add-data-to-httpsession">Step 3: Add data to HttpSession</h3>

<p>Now create a simple form in src/main/resources/templates/index.html.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
<span style="color:#f92672">&lt;html</span> <span style="color:#a6e22e">lang=</span><span style="color:#e6db74">&#34;en&#34;</span> <span style="color:#a6e22e">xmlns:th=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;head&gt;</span>
    <span style="color:#f92672">&lt;meta</span> <span style="color:#a6e22e">charset=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;title&gt;</span>Spring Session + JDBC Demo<span style="color:#f92672">&lt;/title&gt;</span>
<span style="color:#f92672">&lt;/head&gt;</span>
<span style="color:#f92672">&lt;body&gt;</span>
    <span style="color:#f92672">&lt;div&gt;</span>
        <span style="color:#f92672">&lt;form</span> <span style="color:#a6e22e">th:action=</span><span style="color:#e6db74">&#34;@{/messages}&#34;</span> <span style="color:#a6e22e">method=</span><span style="color:#e6db74">&#34;post&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;textarea</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;msg&#34;</span> <span style="color:#a6e22e">cols=</span><span style="color:#e6db74">&#34;40&#34;</span> <span style="color:#a6e22e">rows=</span><span style="color:#e6db74">&#34;4&#34;</span><span style="color:#f92672">&gt;&lt;/textarea&gt;</span>
            <span style="color:#f92672">&lt;input</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;Save&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/form&gt;</span>    
    <span style="color:#f92672">&lt;/div&gt;</span>
     
    <span style="color:#f92672">&lt;div&gt;</span>         
        <span style="color:#f92672">&lt;h2&gt;</span>Messages<span style="color:#f92672">&lt;/h2&gt;</span>             
        <span style="color:#f92672">&lt;ul</span> <span style="color:#a6e22e">th:each=</span><span style="color:#e6db74">&#34;m : ${messages}&#34;</span><span style="color:#f92672">&gt;</span>                
          <span style="color:#f92672">&lt;li</span> <span style="color:#a6e22e">th:text=</span><span style="color:#e6db74">&#34;${m}&#34;</span><span style="color:#f92672">&gt;</span>msg<span style="color:#f92672">&lt;/li&gt;</span>        
        <span style="color:#f92672">&lt;/ul&gt;</span>
    <span style="color:#f92672">&lt;/div&gt;</span>
<span style="color:#f92672">&lt;/body&gt;</span>
<span style="color:#f92672">&lt;/html&gt;</span></code></pre></div>

<p>Let us implement a Controller to add messages to HttpSession and display them.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> org.springframework.stereotype.Controller<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.ui.Model<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PostMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestParam<span style="color:#f92672">;</span>
 
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpSession<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>
 
<span style="color:#a6e22e">@Controller</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessagesController</span> 
<span style="color:#f92672">{</span>
 
    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">index</span><span style="color:#f92672">(</span>Model model<span style="color:#f92672">,</span> HttpSession session<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> msgs <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;)</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MY_MESSAGES&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>msgs <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            msgs <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
        <span style="color:#f92672">}</span>
        model<span style="color:#f92672">.</span><span style="color:#a6e22e">addAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;messages&#34;</span><span style="color:#f92672">,</span> msgs<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;index&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
 
    <span style="color:#a6e22e">@PostMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/messages&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">saveMessage</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">)</span> String msg<span style="color:#f92672">,</span> HttpServletRequest request<span style="color:#f92672">)</span> 
    <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> msgs <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;)</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MY_MESSAGES&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>msgs <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            msgs <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
            request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MY_MESSAGES&#34;</span><span style="color:#f92672">,</span> msgs<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        msgs<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;redirect:/&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>

<p>Now you can start the application and add some messages to HttpSession and you can see the rows in
<strong>SPRING_SESSION, SPRING_SESSION_ATTRIBUTES</strong> tables.
By default, Spring Session converts the objects that we are trying to add to HttpSession into <strong>ByteArray</strong> and store it in the table.</p>

<h2 id="spring-session-with-spring-security">Spring Session with Spring Security</h2>

<p>Spring Session seamlessly integrates with Spring Security because of SpringBoot’s auto-configuration.
Let us add Spring Security to our application.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-security<span style="color:#f92672">&lt;/artifactId&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span></code></pre></div>

<p>Add a default user credentials in application.properties as follows:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-properties" data-lang="properties">spring.security.user.name=admin
spring.security.user.password=secret</code></pre></div>

<p>Now if you try to access <a href="http://localhost:8080/">http://localhost:8080/</a> you will be redirected to auto-generated Login page.
Once you login and see the data in <strong>SPRING_SESSION</strong> table you can see that login username is stored in <strong>PRINCIPAL_NAME</strong> column.</p>

<h3 id="how-does-spring-session-work">How does Spring Session work?</h3>

<p>Spring Session provides implementations for <strong>HttpServletRequest</strong> and <strong>HttpSession</strong> which are <strong>SessionRepositoryRequestWrapper</strong>
 and <strong>HttpSessionWrapper</strong>. Spring Session provides <strong>SessionRepositoryFilter</strong> to intercept all the requests and wrap the <strong>HttpServletRequest</strong>
  in <strong>SessionRepositoryRequestWrapper</strong>.</p>

<p>In <strong>SessionRepositoryRequestWrapper.getSession(boolean)</strong> is overriden to return <strong>HttpSessionWrapper</strong> object instead of default server implementation of HttpSession.
The <strong>HttpSessionWrapper</strong> uses <strong>SessionRepository</strong> to persist session information in a datastore.</p>

<p>The SessionRepository interface has various methods to manage sessions.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">SessionRepository</span><span style="color:#f92672">&lt;</span>S <span style="color:#66d9ef">extends</span> Session<span style="color:#f92672">&gt;</span> 
<span style="color:#f92672">{</span>
  S <span style="color:#a6e22e">createSession</span><span style="color:#f92672">();</span>
 
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">save</span><span style="color:#f92672">(</span>S session<span style="color:#f92672">);</span>
 
  S <span style="color:#a6e22e">findById</span><span style="color:#f92672">(</span>String id<span style="color:#f92672">);</span>
 
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deleteById</span><span style="color:#f92672">(</span>String id<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span></code></pre></div>

<p>This SessionRepository interface is implemented by various classes based on the type of backend we are using.
In our case, we are using <strong>JdbcOperationsSessionRepository</strong> provided by <strong>spring-session-jdbc</strong>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>As you might have already observed we can manage user sessions effectively by using Spring Session with very minimal configuration
because of Spring Boot auto-configuration. If for any reason we want to change the backend from JDBC to Redis or Hazelcast etc
it is only simple configuration change as we are not directly depending on any Spring Session classes.</p>

<blockquote>
<p>You can find the source code for this article at <a href="https://github.com/sivaprasadreddy/spring-session-samples">https://github.com/sivaprasadreddy/spring-session-samples</a></p>
</blockquote>

        </div>
        <div class="sharedaddy sd-sharing-enabled">
    <div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing">
        <h3 class="sd-title">Share this:</h3>
        <div class="sd-content">
            <ul>
                <li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-1144" class="share-twitter sd-button share-icon no-text" href="https://twitter.com/intent/tweet?status=Session%20Management%20using%20Spring%20Session%20with%20JDBC%20DataStore-https%3a%2f%2fsivalabs.github.io%2f2018%2f02%2fsession-management-using-spring-session-jdbc-datastore%2f" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li>
                <li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-1144" class="share-facebook sd-button share-icon no-text" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsivalabs.github.io%2f2018%2f02%2fsession-management-using-spring-session-jdbc-datastore%2f" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li>
                <li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-1144" class="share-google-plus-1 sd-button share-icon no-text" href="https://plus.google.com/share?url=https%3a%2f%2fsivalabs.github.io%2f2018%2f02%2fsession-management-using-spring-session-jdbc-datastore%2f" target="_blank" title="Click to share on Google+"><span></span><span class="sharing-screen-reader-text">Click to share on Google+ (Opens in new window)</span></a></li>
                <li class="share-reddit"><a rel="nofollow" data-shared="" class="share-reddit sd-button share-icon no-text" href="http://www.reddit.com/submit?url=https%3a%2f%2fsivalabs.github.io%2f2018%2f02%2fsession-management-using-spring-session-jdbc-datastore%2f&title=Session%20Management%20using%20Spring%20Session%20with%20JDBC%20DataStore" target="_blank" title="Click to share on Reddit"><span></span><span class="sharing-screen-reader-text">Click to share on Reddit (Opens in new window)</span></a></li>
                <li class="share-linkedin"><a rel="nofollow" data-shared="sharing-linkedin-1144" class="share-linkedin sd-button share-icon no-text" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsivalabs.github.io%2f2018%2f02%2fsession-management-using-spring-session-jdbc-datastore%2f&title=Session%20Management%20using%20Spring%20Session%20with%20JDBC%20DataStore" target="_blank" title="Click to share on LinkedIn"><span></span><span class="sharing-screen-reader-text">Click to share on LinkedIn (Opens in new window)</span></a></li>
                <li class="share-end"></li>
            </ul>
        </div>
    </div>
</div>

    </div>
</article>


<div class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "sivalabs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>



<nav class="navigation post-navigation" role="navigation">
	<h2 class="screen-reader-text">Post navigation</h2>
	<div class="nav-links">
		<div class="nav-previous">
			<a href="/2018/02/springboot-messaging-rabbitmq/" rel="next">
				<i class="fa fa-chevron-left"></i>
				<span class="post-title">SpringBoot Messaging with RabbitMQ</span>
			</a>
		</div>
		<div class="nav-next">
			<a href="/2018/01/ci-cd-springboot-applications-using-travis-ci/" rel="prev">
                <span class="post-title">CI/CD for SpringBoot applications using Travis-CI
                    <i class="fa fa-chevron-right"></i>
                </span>
			</a>
		</div>
	</div>
</nav>

</main>

            </section>

            <section id="secondary" class="sidebar widget-area clearfix" role="complementary">
                
<aside id="zoom-social-icons-widget-2" class="widget zoom-social-icons-widget">
    <h3 class="widget-title">Follow Me</h3>

    <ul class="zoom-social-icons-list zoom-social-icons-list--with-canvas zoom-social-icons-list--rounded zoom-social-icons-list--no-labels">

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="https://github.com/sivaprasadreddy"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-github"
                          data-hover-rule="background-color" data-hover-color="#221e1b"

                    ></span>
            </a>
        </li>
        

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="https://twitter.com/sivalabs"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-twitter"
                          data-hover-rule="background-color" data-hover-color="#55acee"
                    ></span>
            </a>
        </li>
        

        

        

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="https://in.linkedin.com/in/siva-prasad-reddy-k-3a909172"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-linkedin"
                          data-hover-rule="background-color" data-hover-color="#3371b7"
                    ></span>
            </a>
        </li>

        

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="http://www.youtube.com/c/SivaPrasadReddy%20"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-youtube"
                          data-hover-rule="background-color" data-hover-color="#e02a20"
                    ></span>
            </a>
        </li>
        
    </ul>
</aside>



<aside id="recent-posts-2" class="widget widget_recent_entries clearfix">
    <div class="widget-header">
        <h3 class="widget-title">Recent Posts</h3>
    </div>
    <ul>
        <li class="widget__item"><a class="widget__link" href="/2020/03/what-i-learned-2020-week-11/">What I Learned in Week-11, 2020</a></li>
        <li class="widget__item"><a class="widget__link" href="/2020/02/spring-boot-integration-testing-using-testcontainers-starter/">SpringBoot Integration Testing using TestContainers Starter</a></li>
        <li class="widget__item"><a class="widget__link" href="/2020/01/creating-yeoman-based-springboot-generator/">Creating Yeoman based SpringBoot Generator</a></li>
        <li class="widget__item"><a class="widget__link" href="/2019/10/testing-rest-apis-with-postman-newman/">Testing REST APIs using Postman and Newman</a></li>
        <li class="widget__item"><a class="widget__link" href="/2019/10/spring-boot-testing/">Testing SpringBoot Applications</a></li>
    </ul>

</aside>

<aside id="top-posts-2" class="widget widget_top-posts clearfix">
    <div class="widget-header"><h3 class="widget-title">Top Posts &amp; Pages</h3></div>
    <ul>

        <li>
            <a href="/2016/03/why-springboot/"
            class="bump-view" data-bump-view="tp">
            Why SpringBoot?</a>
        </li>

        <li>
            <a href="/2016/03/how-springboot-autoconfiguration-magic/"
            class="bump-view" data-bump-view="tp">
            How SpringBoot AutoConfiguration magic works?</a>
        </li>

        <li>
            <a href="/2015/11/developing-a-simple-e-commerce-application-from-scratch-to-production-using-springboot/"
            class="bump-view" data-bump-view="tp">
            Developing a simple e-commerce application from scratch to production using SpringBoot</a>
        </li>

        <li>
            <a href="/2013/12/clean-code-dont-mix-different-levels-of-abstractions/"
            class="bump-view" data-bump-view="tp">
            Clean Code: Don’t mix different levels of abstractions</a>
        </li>

        <li>
            <a href="/2015/06/a-developers-perspective-on-spring-vs-javaee/"
            class="bump-view" data-bump-view="tp">
            A Developers Perspective on Spring vs JavaEE</a>
        </li>

        <li>
            <a href="/2015/07/my-life-as-software-developer-in-india/"
            class="bump-view" data-bump-view="tp">
            My Life as a Software Developer in India</a>
        </li>

        <li>
            <a href="/2011/01/10-things-to-become-outstanding-java/"
            class="bump-view" data-bump-view="tp">
            10 things to become an outstanding Java developer</a>
        </li>
</ul>
</aside>

<aside id="categories-2" class="widget widget_categories clearfix">
    <div class="widget-header"><h3 class="widget-title">Categories</h3></div>
    <ul>
        <li class="cat-item"><a href="/categories/best-practices">Best-Practices</a></li>
        <li class="cat-item"><a href="/categories/blog">Blog</a></li>
        <li class="cat-item"><a href="/categories/books">Books</a></li>
        <li class="cat-item"><a href="/categories/ide">Ide</a></li>
        <li class="cat-item"><a href="/categories/java">Java</a></li>
        <li class="cat-item"><a href="/categories/javaee">Javaee</a></li>
        <li class="cat-item"><a href="/categories/kafka">Kafka</a></li>
        <li class="cat-item"><a href="/categories/linux">Linux</a></li>
        <li class="cat-item"><a href="/categories/microservices">Microservices</a></li>
        <li class="cat-item"><a href="/categories/misc">Misc</a></li>
        <li class="cat-item"><a href="/categories/spring">Spring</a></li>
        <li class="cat-item"><a href="/categories/springboot">Springboot</a></li>
        <li class="cat-item"><a href="/categories/springcloud">Springcloud</a></li>
        <li class="cat-item"><a href="/categories/testing">Testing</a></li>
        <li class="cat-item"><a href="/categories/tips">Tips</a></li>
        <li class="cat-item"><a href="/categories/travis-ci">Travis-Ci</a></li>
        <li class="cat-item"><a href="/categories/videos">Videos</a></li>
    </ul>
</aside>


<aside id="tag_cloud-3" class="widget widget_tag_cloud clearfix">
    <div class="widget-header"><h3 class="widget-title">Tags</h3></div>
    <div class="tagcloud">

        <div class="widget__content">
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/android" title="android">android</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/best-practices" title="best-practices">best-practices</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/blog" title="blog">blog</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/blogging" title="blogging">blogging</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/books" title="books">books</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/e-commerce" title="e-commerce">e-commerce</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/ide" title="ide">ide</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/interviews" title="interviews">interviews</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/it" title="it">it</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/java" title="java">java</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/java-blogging" title="java-blogging">java-blogging</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/javaee" title="javaee">javaee</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/jcart" title="jcart">jcart</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/jooq" title="jooq">jooq</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/jsf" title="jsf">jsf</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/kafka" title="kafka">kafka</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/kafka-springboot-spring" title="kafka-springboot-spring">kafka-springboot-spring</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/linux" title="linux">linux</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/maven" title="maven">maven</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/microservices" title="microservices">microservices</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/mybatis" title="mybatis">mybatis</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/postman-newman-rest" title="postman-newman-rest">postman-newman-rest</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/primefaces" title="primefaces">primefaces</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/rabbitmq" title="rabbitmq">rabbitmq</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/servlets-jsp" title="servlets-jsp">servlets-jsp</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/spring" title="spring">spring</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/spring-springboot-bestpractices" title="spring-springboot-bestpractices">spring-springboot-bestpractices</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/spring-springboot-testing" title="spring-springboot-testing">spring-springboot-testing</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springboot" title="springboot">springboot</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springboot-testcontainers" title="springboot-testcontainers">springboot-testcontainers</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springboot-yeoman" title="springboot-yeoman">springboot-yeoman</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springcloud" title="springcloud">springcloud</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springsession" title="springsession">springsession</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/tips" title="tips">tips</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/travis-ci" title="travis-ci">travis-ci</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/videos" title="videos">videos</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/virtualbox" title="virtualbox">virtualbox</a>
        </div>
    </div>
</aside>
            </section>
        </div>
        <div id="footer" class="footer-wrap">
            <footer id="colophon" class="site-footer container clearfix" role="contentinfo">
    <div id="footer-text" class="site-info">
        <span class="credit-link">
            <a href="/" target="_blank">SivaLabs</a>
            Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
        </span>
    </div>
</footer>

        </div>
    </div>

</body>
</html>
