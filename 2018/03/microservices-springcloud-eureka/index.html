<!DOCTYPE html><html lang="en-US" prefix="og: http://ogp.me/ns#"><head><div class="analytics"><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-71296890-1","auto"),ga("send","pageview")</script><script async src="//www.google-analytics.com/analytics.js"></script></div><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="title" property="title" content="SivaLabs - MicroServices - Part 3 : Spring Cloud Service Registry and Discovery"><meta name="description" property="description" content="Java, Spring, SpringBoot, SpringCloud, JPA, Hibernate, DevOps, MicroServices, Docker tutorials - "><title>SivaLabs - MicroServices - Part 3 : Spring Cloud Service Registry and Discovery</title><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://sivalabs.github.io/images/EurekaDashboard.png"><meta name="twitter:title" content="MicroServices - Part 3 : Spring Cloud Service Registry and Discovery"><meta name="twitter:description" content="In the microservices world, Service Registry and Discovery plays an important role because we most likely run multiple instances of services and we need a mechanism to call other services without hardcoding their hostnames or port numbers. In addition to that, in Cloud environments service instances may come up and go down anytime. So we need some automatic service registration and discovery mechanism. Spring Cloud provides Service Registry and Discovery features, as usual, with multiple options."><meta name="twitter:site" content="@sivalabs"><meta name="twitter:creator" content="@sivalabs"><meta property="og:title" content="MicroServices - Part 3 : Spring Cloud Service Registry and Discovery"><meta property="og:description" content="In the microservices world, Service Registry and Discovery plays an important role because we most likely run multiple instances of services and we need a mechanism to call other services without hardcoding their hostnames or port numbers. In addition to that, in Cloud environments service instances may come up and go down anytime. So we need some automatic service registration and discovery mechanism. Spring Cloud provides Service Registry and Discovery features, as usual, with multiple options."><meta property="og:type" content="article"><meta property="og:url" content="https://sivalabs.github.io/2018/03/microservices-springcloud-eureka/"><meta property="og:image" content="https://sivalabs.github.io/images/EurekaDashboard.png"><meta property="article:published_time" content="2018-03-08T07:59:17&#43;05:30"><meta property="article:modified_time" content="2018-03-08T07:59:17&#43;05:30"><meta itemprop="name" content="MicroServices - Part 3 : Spring Cloud Service Registry and Discovery"><meta itemprop="description" content="In the microservices world, Service Registry and Discovery plays an important role because we most likely run multiple instances of services and we need a mechanism to call other services without hardcoding their hostnames or port numbers. In addition to that, in Cloud environments service instances may come up and go down anytime. So we need some automatic service registration and discovery mechanism. Spring Cloud provides Service Registry and Discovery features, as usual, with multiple options."><meta itemprop="datePublished" content="2018-03-08T07:59:17&#43;05:30"><meta itemprop="dateModified" content="2018-03-08T07:59:17&#43;05:30"><meta itemprop="wordCount" content="1313"><meta itemprop="image" content="https://sivalabs.github.io/images/EurekaDashboard.png"><meta itemprop="keywords" content="microservices,springboot,springcloud,"><link rel="stylesheet" href="/assets/css/custom-fonts.css" type="text/css" media="all"><link rel="stylesheet" href="/assets/css/style.css" type="text/css" media="all"><link rel="stylesheet" href="/assets/css/genericons.css" type="text/css" media="all"><link rel="stylesheet" href="/assets/css/font-awesome.min.css" type="text/css" media="all"><link rel="stylesheet" href="/assets/css/socicon.css" type="text/css" media="all"><link rel="stylesheet" href="/assets/css/social-logos/social-logos.css" type="text/css" media="all"><link rel="stylesheet" href="/assets/css/jetpack.css" type="text/css" media="all"><link rel="stylesheet" href="/assets/css/custom-styles.css" type="text/css" media="all"><script type="text/javascript" src="/assets/js/jquery-1.12.4.min.js"></script><script type="text/javascript" src="/assets/js/html5shiv.min.js"></script><script type="text/javascript" src="/assets/js/navigation.js"></script><link rel="shortcut icon" href="/favicon.png" type="image/x-icon"></head><body class="home blog logged-in admin-bar no-customize-support post-layout-one-column"><div id="header-top" class="header-bar-wrap"></div><div id="page" class="hfeed site"><a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="masthead" class="site-header clearfix" role="banner"><div class="header-main container clearfix"><div id="logo" class="site-branding clearfix"><h1 class="site-title"><a href="/" title="SivaLabs" rel="home">SivaLabs</a></h1><p class="site-description">My Experiments on Technology</p></div><div class="header-widgets clearfix"></div></div><div id="main-navigation-wrap" class="primary-navigation-wrap"><nav id="main-navigation" class="primary-navigation navigation container clearfix" role="navigation"><ul id="menu-home" class="main-navigation-menu"><li id="menu-item-1145" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-1145"><a href="/">Home</a></li><li id="menu-item-1421" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1421"><a href="/categories/java">Java</a></li><li id="menu-item-1423" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-1423"><a href="/categories/spring">Spring</a><ul class="sub-menu"><li id="menu-item-1424" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1424"><a href="/categories/springboot">Spring Boot</a></li><li id="menu-item-1425" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1425"><a href="/categories/springcloud">Spring Cloud</a></li></ul></li><li id="menu-item-1422" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1422"><a href="/categories/microservices">MicroServices</a></li><li id="menu-item-1151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1151"><a href="/videos">Videos</a></li><li id="menu-item-1161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1161"><a href="/mybooks">My Books</a></li><li id="menu-item-1146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1146"><a href="/contact">Contact</a></li></ul></nav></div></header><div id="content" class="site-content container clearfix"><section id="primary" class="content-archive content-area"><main id="main" class="site-main" role="main"><article class="post type-post status-publish format-standard hentry"><div class="post-inner-content"><header class="entry-header"><div class="entry-meta"><span class="meta-date"><a href="https://sivalabs.github.io/2018/03/microservices-springcloud-eureka/" rel="bookmark"><time class="entry-date published" datetime="2018-03-08T07:59:17">March 08, 2018 </time></a></span><span class="meta-author"><span class="author vcard">Siva</span></span></div><h2 class="entry-title"><a href="https://sivalabs.github.io/2018/03/microservices-springcloud-eureka/" rel="bookmark">MicroServices - Part 3 : Spring Cloud Service Registry and Discovery</a></h2><div><span class="tagcloud post-tags"><i class="fa fa-tags"></i> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/microservices/">microservices</a> &nbsp; <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springboot/">springboot</a> &nbsp; <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springcloud/">springcloud</a></span></div></header><div class="entry-content"><p>In the microservices world, <strong>Service Registry and Discovery</strong> plays an important role because we most likely run multiple instances of services and we need a mechanism to call other services without hardcoding their hostnames or port numbers. In addition to that, in Cloud environments service instances may come up and go down anytime. So we need some automatic service registration and discovery mechanism. <strong>Spring Cloud</strong> provides <strong>Service Registry and Discovery</strong> features, as usual, with multiple options. We can use <strong>Netflix Eureka</strong> or <strong>Consul</strong> for Service Registry and Discovery. In this post, we will learn how to use SpringCloud Netflix Eureka for Service Registry and Discovery.</p><p><strong>MicroServices using Spring Boot &amp; Spring Cloud</strong></p><ul><li><a href="/2018/03/microservices-using-springboot-spring-cloud-part-1-overview/">Part 1 : MicroServices : Spring Boot &amp; Spring Cloud Overview</a></li><li><a href="/2018/03/microservices-part-2-configuration-management-spring-cloud-config-vault/">Part 2 : MicroServices : Configuration Management with Spring Cloud Config and Vault</a></li><li><a href="/2018/03/microservices-springcloud-eureka/">Part 3 : MicroServices : Spring Cloud Service Registry and Discovery</a></li><li><a href="/2018/03/microservices-springcloud-eureka/">Part 4 : MicroServices : Spring Cloud Circuit Breaker using Netflix Hystrix</a></li><li><a href="/2018/03/microservices-part-5-spring-cloud-zuul-proxy-as-api-gateway/">Part 5 : MicroServices : Spring Cloud Zuul Proxy as API Gateway</a></li><li><a href="/2018/03/microservices-part-6-distributed-tracing-with-spring-cloud-sleuth-and-zipkin/">Part 6 : MicroServices : Distributed Tracing with Spring Cloud Sleuth and Zipkin</a></li></ul><p>In my previous post, <a href="/2018/03/microservices-part-2-configuration-management-spring-cloud-config-vault/">Part 2 : MicroServices : Configuration Management with Spring Cloud Config and Vault</a>, we learned how to store configuration parameters externally in a configuration server and how to securely store secrets in Vault.</p><p><strong>In this post, we are going to learn:</strong></p><ul><li>What is Service Registry and Discovery?</li><li>Spring Cloud Netflix Eureka-based Service Registry</li><li>Registering microservices as Eureka Clients</li><li>Discovering other services using Eureka Client</li></ul><h1 id="what-is-service-registry-and-discovery">What is Service Registry and Discovery?</h1><p>Suppose we have 2 microservices <strong>catalog-service</strong> and <strong>inventory-service</strong> and we are running 2 instances of inventory-service at <a href="http://localhost:8181/">http://localhost:8181/</a> and <a href="http://localhost:8282/">http://localhost:8282/</a>. Now let’s say we want to invoke some inventory-service REST endpoint from catalog-service. Which URL should we hit? Generally, in these scenarios, we use a load balancer configuring these 2 URLs to be delegated to and we will invoke the REST endpoint on load balancer URL. Fine.</p><p>But, what if you want to spin up new instances dynamically based on load? Even if you are going to run only few server nodes, manually updating the server node details in load balancer configuration is error-prone and tedious. This is why we need automatic Service Registration mechanism and be able to invoke a service using some logical service id instead of using specific IP Address and port numbers.</p><p>We can use Netflix Eureka Server to create a Service Registry and make our microservices as Eureka Clients so that as soon as we start a microservice it will get registered with Eureka Server automatically with a logical Service ID. Then, the other microservices, which are also Eureka Clients, can use Service ID to invoke REST endpoints.</p><p>Spring Cloud makes it very easy to create a Service Registry and discovering other services using Load Balanced RestTemplate.</p><h1 id="spring-cloud-netflix-eureka-based-service-registry">Spring Cloud Netflix Eureka based Service Registry</h1><p>Let us create a Service Registry using Netflix Eureka which is nothing but a SpringBoot application with <strong>Eureka Server</strong> starter.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-server<span style="color:#f92672">&lt;/artifactId&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span></code></pre></div><p>We need to add <strong>@EnableEurekaServer</strong> annotation to make our SpringBoot application a Eureka Server based Service Registry.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> org.springframework.boot.SpringApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer<span style="color:#f92672">;</span>
 
<span style="color:#a6e22e">@EnableEurekaServer</span>
<span style="color:#a6e22e">@SpringBootApplication</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServiceRegistryApplication</span> <span style="color:#f92672">{</span>
 
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>ServiceRegistryApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div><p>By default, each Eureka Server is also a Eureka client and needs at least one service URL to locate a peer. As we are going to have a single Eureka Server node (Standalone Mode), we are going to disable this client-side behavior by configuring the following properties in application.properties file.</p><p><strong>application.properties</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-properties" data-lang="properties">spring.application.name=service-registry
server.port=8761
eureka.instance.hostname=localhost
eureka.instance.client.registerWithEureka=false
eureka.instance.client.fetchRegistry=false
eureka.instance.client.serviceUrl.defaultZone=http://${eureka.instance.hostname}:${server.port}/eureka/</code></pre></div><p>Netflix Eureka Service provides UI where we can see all the details about registered services.</p><p>Now run <strong>ServiceRegistryApplication</strong> and access <a href="http://localhost:8761">http://localhost:8761</a> which will display the UI similar to below screenshot.</p><p><img src="/images/EurekaDashboard.png" alt="Eureka Dashboard" title="Eureka Dashboard"></p><h1 id="registering-microservices-as-eureka-clients">Registering microservices as Eureka Clients</h1><p>In <a href="/2018/03/microservices-part-2-configuration-management-spring-cloud-config-vault/">Part 2 : MicroServices : Configuration Management with Spring Cloud Config and Vault</a> we have created catalog-service. Let us make this service as a Eureka Client and register with the Eureka Server.</p><p>Add the <strong>Eureka Discovery</strong> starter to <strong>catalog-service</strong> which will add the following dependency.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span style="color:#f92672">&lt;/artifactId&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span></code></pre></div><p>With <strong>spring-cloud-starter-netflix-eureka-client</strong> on classpath, we just need to configure <strong>eureka.client.service-url.defaultZone</strong> property in <strong>application.properties</strong> to automatically register with the Eureka Server.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-properties" data-lang="properties">eureka.client.service-url.defaultZone=http://localhost:8761/eureka/</code></pre></div><p>When a service is registered with Eureka Server it keeps sending heartbeats for certain interval. If Eureka server didn’t receive heartbeat from any service instance it will assume service instance is down and take it out from the pool.</p><p>With this configuration in place, start catalog-service and visit <a href="http://localhost:8761">http://localhost:8761</a>. You should see catalog-service is registered with <strong>SERVICE ID</strong> as <strong>CATALOG-SERVICE</strong>. You can also notice the status as <strong>UP(1)</strong> which means the services are up and running and one instance of <strong>catalog-service</strong> is running.</p><p>Let us start another instance of catalog-service on a different port using the following command.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">java -jar -Dserver.port<span style="color:#f92672">=</span><span style="color:#ae81ff">9797</span> target/catalog-service-0.0.1-SNAPSHOT-exec.jar</code></pre></div><p>Now if you go to <a href="http://localhost:8761">http://localhost:8761</a> you will notice that 2 instances of catalog-service got registered and you can see their hostname: port details as well.</p><h1 id="discovering-other-services-using-eureka-client">Discovering other services using Eureka Client</h1><p>In the previous section, we have learned how to register a service as Eureka client and we also tried registering multiple instances of the same service.</p><p>Now we will create another microservice <strong>inventory-service</strong> which exposes a REST endpoint <strong><a href="http://localhost:8282/api/invenory/{productCode">http://localhost:8282/api/invenory/{productCode</a>}</strong> which will give the currently available quantity as a response.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">{
    <span style="color:#a6e22e">productCode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;P001&#34;</span>,
    <span style="color:#a6e22e">availableQuantity</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">250</span>
}
</code></pre></div><p>Create <strong>inventory-service</strong> SpringBoot application with <strong>Web, JPA, H2/MySQL, Actuator, Config Client and Eureka Discovery</strong> starters.</p><p>Create a REST Controller to return Inventory details for a given product code.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestController</span>
<span style="color:#a6e22e">@Slf4j</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InventoryController</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> InventoryItemRepository inventoryItemRepository<span style="color:#f92672">;</span>
 
    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">InventoryController</span><span style="color:#f92672">(</span>InventoryItemRepository inventoryItemRepository<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">inventoryItemRepository</span> <span style="color:#f92672">=</span> inventoryItemRepository<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
 
    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/api/inventory/{productCode}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>InventoryItem<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findInventoryByProductCode</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;productCode&#34;</span><span style="color:#f92672">)</span> String productCode<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Finding inventory for product code :&#34;</span><span style="color:#f92672">+</span>productCode<span style="color:#f92672">);</span>
        Optional<span style="color:#f92672">&lt;</span>InventoryItem<span style="color:#f92672">&gt;</span> inventoryItem <span style="color:#f92672">=</span> inventoryItemRepository<span style="color:#f92672">.</span><span style="color:#a6e22e">findByProductCode</span><span style="color:#f92672">(</span>productCode<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>inventoryItem<span style="color:#f92672">.</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">(</span>inventoryItem<span style="color:#f92672">,</span> HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">OK</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div><blockquote><p>Please look at the GitHub Repository for the InventoryItem, InventoryItemRepository etc code.</p></blockquote><p>Register <strong>inventory-service</strong> with Eureka server by configuring Eureka serviceUrl in <strong>src/main/resources/bootstrap.properties</strong>.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-properties" data-lang="properties">spring.application.name=inventory-service
server.port=8282
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/</code></pre></div><p>Now build inventory-service and start 2 instances of it by running following commands.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">java -jar -Dserver.port<span style="color:#f92672">=</span><span style="color:#ae81ff">9898</span> target/inventory-service-0.0.1-SNAPSHOT-exec.jar
 
java -jar -Dserver.port<span style="color:#f92672">=</span><span style="color:#ae81ff">9999</span> target/inventory-service-0.0.1-SNAPSHOT-exec.jar</code></pre></div><p>Now you can visit Eureka Dashboard <a href="http://localhost:8761/">http://localhost:8761/</a> and see 2 instances of inventory-service registered.</p><p>Suppose we want to invoke inventory-service REST endpoint from catalog-service. We can use <strong>RestTemplate</strong> to invoke REST endpoint but there are 2 instances running.</p><p>We can register <strong>RestTemplate</strong> as a Spring bean with <strong>@LoadBalanced</strong> annotation. The RestTemplate with <strong>@LoadBalanced</strong> annotation will internally use <strong>Ribbon LoadBalancer</strong> to resolve the <strong>ServiceID</strong> and invoke REST endpoint using one of the available servers.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@SpringBootApplication</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CatalogServiceApplication</span> <span style="color:#f92672">{</span>
 
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#a6e22e">@LoadBalanced</span>
    <span style="color:#66d9ef">public</span> RestTemplate <span style="color:#a6e22e">restTemplate</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> RestTemplate<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
 
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>CatalogServiceApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div><p>Now we can use RestTemplate to invoke inventory-service endpoint at <strong><a href="http://inventory-service/api/inventory/{productCode">http://inventory-service/api/inventory/{productCode</a>}</strong>.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Service</span>
<span style="color:#a6e22e">@Transactional</span>
<span style="color:#a6e22e">@Slf4j</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductService</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ProductRepository productRepository<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> RestTemplate restTemplate<span style="color:#f92672">;</span>
     
    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ProductService</span><span style="color:#f92672">(</span>ProductRepository productRepository<span style="color:#f92672">,</span> RestTemplate restTemplate<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">productRepository</span> <span style="color:#f92672">=</span> productRepository<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">restTemplate</span> <span style="color:#f92672">=</span> restTemplate<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
 
    <span style="color:#66d9ef">public</span> Optional<span style="color:#f92672">&lt;</span>Product<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findProductByCode</span><span style="color:#f92672">(</span>String code<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Optional<span style="color:#f92672">&lt;</span>Product<span style="color:#f92672">&gt;</span> productOptional <span style="color:#f92672">=</span> productRepository<span style="color:#f92672">.</span><span style="color:#a6e22e">findByCode</span><span style="color:#f92672">(</span>code<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>productOptional<span style="color:#f92672">.</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Fetching inventory level for product_code: &#34;</span><span style="color:#f92672">+</span>code<span style="color:#f92672">);</span>
            ResponseEntity<span style="color:#f92672">&lt;</span>ProductInventoryResponse<span style="color:#f92672">&gt;</span> itemResponseEntity <span style="color:#f92672">=</span>
                    restTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">getForEntity</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://inventory-service/api/inventory/{code}&#34;</span><span style="color:#f92672">,</span>
                                                ProductInventoryResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span>
                                                code<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>itemResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">OK</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                Integer quantity <span style="color:#f92672">=</span> itemResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAvailableQuantity</span><span style="color:#f92672">();</span>
                log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Available quantity: &#34;</span><span style="color:#f92672">+</span>quantity<span style="color:#f92672">);</span>
                productOptional<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setInStock</span><span style="color:#f92672">(</span>quantity<span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                log<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Unable to get inventory level for product_code: &#34;</span><span style="color:#f92672">+</span>code <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, StatusCode: &#34;</span><span style="color:#f92672">+</span>itemResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">());</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> productOptional<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductInventoryResponse</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> String productCode<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> availableQuantity<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span></code></pre></div><p>Note that we have used <a href="http://inventory-service/api/inventory/{code">http://inventory-service/api/inventory/{code</a>} instead of <a href="http://localhost:9898/api/inventory/{code">http://localhost:9898/api/inventory/{code</a>} or <a href="http://localhost:9999/api/inventory/{code">http://localhost:9999/api/inventory/{code</a>} directly.</p><p>With this kind of automatic Service Registration and Discovery mechanism, we no need to worry about how many instances are running and what are their hostnames and ports etc.</p><blockquote><p>You can find the source code for this article at <a href="https://github.com/sivaprasadreddy/spring-boot-microservices-series">https://github.com/sivaprasadreddy/spring-boot-microservices-series</a></p></blockquote><h1 id="summary">Summary</h1><p>In this post, we learned how to use Spring Cloud <strong>Netflix Eureka</strong> for <strong>Service Registry and Discovery</strong>. In next post, we will look at implementing <strong>Circuit Breaker pattern using Netflix Hystrix</strong>.</p><h1 id="references">References:</h1><ul><li><a href="http://cloud.spring.io/spring-cloud-static/Finchley.M7/single/spring-cloud.html#_spring_cloud_netflix">Spring Cloud Netflix</a></li></ul></div><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-1144" class="share-twitter sd-button share-icon no-text" href="https://twitter.com/intent/tweet?status=MicroServices%20-%20Part%203%20%3a%20Spring%20Cloud%20Service%20Registry%20and%20Discovery-https%3a%2f%2fsivalabs.github.io%2f2018%2f03%2fmicroservices-springcloud-eureka%2f" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li><li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-1144" class="share-facebook sd-button share-icon no-text" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsivalabs.github.io%2f2018%2f03%2fmicroservices-springcloud-eureka%2f" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li><li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-1144" class="share-google-plus-1 sd-button share-icon no-text" href="https://plus.google.com/share?url=https%3a%2f%2fsivalabs.github.io%2f2018%2f03%2fmicroservices-springcloud-eureka%2f" target="_blank" title="Click to share on Google+"><span></span><span class="sharing-screen-reader-text">Click to share on Google+ (Opens in new window)</span></a></li><li class="share-reddit"><a rel="nofollow" data-shared="" class="share-reddit sd-button share-icon no-text" href="http://www.reddit.com/submit?url=https%3a%2f%2fsivalabs.github.io%2f2018%2f03%2fmicroservices-springcloud-eureka%2f&title=MicroServices%20-%20Part%203%20%3a%20Spring%20Cloud%20Service%20Registry%20and%20Discovery" target="_blank" title="Click to share on Reddit"><span></span><span class="sharing-screen-reader-text">Click to share on Reddit (Opens in new window)</span></a></li><li class="share-linkedin"><a rel="nofollow" data-shared="sharing-linkedin-1144" class="share-linkedin sd-button share-icon no-text" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsivalabs.github.io%2f2018%2f03%2fmicroservices-springcloud-eureka%2f&title=MicroServices%20-%20Part%203%20%3a%20Spring%20Cloud%20Service%20Registry%20and%20Discovery" target="_blank" title="Click to share on LinkedIn"><span></span><span class="sharing-screen-reader-text">Click to share on LinkedIn (Opens in new window)</span></a></li><li class="share-end"></li></ul></div></div></div></div></article><div class="comments"><div id="disqus_thread"></div><script>var disqus_config=function(){};!function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1)return void(document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.");var e=document,t=e.createElement("script");t.async=!0,t.src="//sivalabs.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div><nav class="navigation post-navigation" role="navigation"><h2 class="screen-reader-text">Post navigation</h2><div class="nav-links"><div class="nav-previous"><a href="/2018/03/spring-cloud-netflix-circuit-breaker/" rel="next"><i class="fa fa-chevron-left"></i> <span class="post-title">MicroServices - Part 4 : Spring Cloud Circuit Breaker using Netflix Hystrix</span></a></div><div class="nav-next"><a href="/2018/03/microservices-part-2-configuration-management-spring-cloud-config-vault/" rel="prev"><span class="post-title">MicroServices - Part 2 : Configuration Management with Spring Cloud Config and Vault <i class="fa fa-chevron-right"></i></span></a></div></div></nav></main></section><section id="secondary" class="sidebar widget-area clearfix" role="complementary"><aside id="zoom-social-icons-widget-2" class="widget zoom-social-icons-widget"><h3 class="widget-title">Follow Me</h3><ul class="zoom-social-icons-list zoom-social-icons-list--with-canvas zoom-social-icons-list--rounded zoom-social-icons-list--no-labels"><li class="zoom-social_icons-list__item"><a class="zoom-social_icons-list__link" href="https://github.com/sivaprasadreddy" target="_blank"><span class="zoom-social_icons-list-span socicon socicon-github" data-hover-rule="background-color" data-hover-color="#221e1b"></span></a></li><li class="zoom-social_icons-list__item"><a class="zoom-social_icons-list__link" href="https://twitter.com/sivalabs" target="_blank"><span class="zoom-social_icons-list-span socicon socicon-twitter" data-hover-rule="background-color" data-hover-color="#55acee"></span></a></li><li class="zoom-social_icons-list__item"><a class="zoom-social_icons-list__link" href="https://facebook.com/sivaprasadreddy.k" target="_blank"><span class="zoom-social_icons-list-span socicon socicon-facebook" data-hover-rule="background-color" data-hover-color="#3b5998"></span></a></li><li class="zoom-social_icons-list__item"><a class="zoom-social_icons-list__link" href="https://plus.google.com/u/0/&#43;SivaPrasadReddy" target="_blank"><span class="zoom-social_icons-list-span socicon socicon-google"></span></a></li><li class="zoom-social_icons-list__item"><a class="zoom-social_icons-list__link" href="https://in.linkedin.com/in/siva-prasad-reddy-k-3a909172" target="_blank"><span class="zoom-social_icons-list-span socicon socicon-linkedin" data-hover-rule="background-color" data-hover-color="#3371b7"></span></a></li><li class="zoom-social_icons-list__item"><a class="zoom-social_icons-list__link" href="http://www.youtube.com/c/SivaPrasadReddy%20" target="_blank"><span class="zoom-social_icons-list-span socicon socicon-youtube" data-hover-rule="background-color" data-hover-color="#e02a20"></span></a></li></ul></aside><aside id="recent-posts-2" class="widget widget_recent_entries clearfix"><div class="widget-header"><h3 class="widget-title">Recent Posts</h3></div><ul><li class="widget__item"><a class="widget__link" href="/2018/03/microservices-part-6-distributed-tracing-with-spring-cloud-sleuth-and-zipkin/">MicroServices - Part 6 : Distributed Tracing with Spring Cloud Sleuth and Zipkin</a></li><li class="widget__item"><a class="widget__link" href="/2018/03/microservices-part-5-spring-cloud-zuul-proxy-as-api-gateway/">MicroServices - Part 5 : Spring Cloud Zuul Proxy as API Gateway</a></li><li class="widget__item"><a class="widget__link" href="/2018/03/spring-cloud-netflix-circuit-breaker/">MicroServices - Part 4 : Spring Cloud Circuit Breaker using Netflix Hystrix</a></li><li class="widget__item"><a class="widget__link" href="/2018/03/microservices-springcloud-eureka/">MicroServices - Part 3 : Spring Cloud Service Registry and Discovery</a></li><li class="widget__item"><a class="widget__link" href="/2018/03/microservices-part-2-configuration-management-spring-cloud-config-vault/">MicroServices - Part 2 : Configuration Management with Spring Cloud Config and Vault</a></li></ul></aside><aside id="top-posts-2" class="widget widget_top-posts clearfix"><div class="widget-header"><h3 class="widget-title">Top Posts &amp; Pages</h3></div><ul><li><a href="/2016/03/why-springboot/" class="bump-view" data-bump-view="tp">Why SpringBoot?</a></li><li><a href="/2016/03/how-springboot-autoconfiguration-magic/" class="bump-view" data-bump-view="tp">How SpringBoot AutoConfiguration magic works?</a></li><li><a href="/2015/11/developing-a-simple-e-commerce-application-from-scratch-to-production-using-springboot/" class="bump-view" data-bump-view="tp">Developing a simple e-commerce application from scratch to production using SpringBoot</a></li><li><a href="/2013/12/clean-code-dont-mix-different-levels-of-abstractions/" class="bump-view" data-bump-view="tp">Clean Code: Don’t mix different levels of abstractions</a></li><li><a href="/2015/06/a-developers-perspective-on-spring-vs-javaee/" class="bump-view" data-bump-view="tp">A Developers Perspective on Spring vs JavaEE</a></li><li><a href="/2015/07/my-life-as-software-developer-in-india/" class="bump-view" data-bump-view="tp">My Life as a Software Developer in India</a></li><li><a href="/2011/01/10-things-to-become-outstanding-java/" class="bump-view" data-bump-view="tp">10 things to become an outstanding Java developer</a></li></ul></aside><aside id="categories-2" class="widget widget_categories clearfix"><div class="widget-header"><h3 class="widget-title">Categories</h3></div><ul><li class="cat-item"><a href="/categories/best-practices">Best Practices</a></li><li class="cat-item"><a href="/categories/blog">Blog</a></li><li class="cat-item"><a href="/categories/books">Books</a></li><li class="cat-item"><a href="/categories/ide">IDE</a></li><li class="cat-item"><a href="/categories/java">Java</a></li><li class="cat-item"><a href="/categories/javaee">JavaEE</a></li><li class="cat-item"><a href="/categories/linux">Linux</a></li><li class="cat-item"><a href="/categories/misc">Misc</a></li><li class="cat-item"><a href="/categories/spring">Spring</a></li><li class="cat-item"><a href="/categories/tips">Tips</a></li><li class="cat-item"><a href="/categories/books">Books</a></li><li class="cat-item"><a href="/categories/microservices">Microservices</a></li><li class="cat-item"><a href="/categories/springboot">Springboot</a></li><li class="cat-item"><a href="/categories/springcloud">Springcloud</a></li><li class="cat-item"><a href="/categories/travis-ci">Travis-Ci</a></li><li class="cat-item"><a href="/categories/videos">Videos</a></li></ul></aside><aside id="tag_cloud-3" class="widget widget_tag_cloud clearfix"><div class="widget-header"><h3 class="widget-title">Tags</h3></div><div class="tagcloud"><div class="widget__content"><a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/android" title="Android">Android</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/best-practices" title="Best Practices">Best Practices</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/blog" title="Blog">Blog</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/blogging" title="Blogging">Blogging</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/books" title="Books">Books</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/e-commerce" title="E-Commerce">E-Commerce</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/ide" title="IDE">IDE</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/it" title="IT">IT</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/interviews" title="Interviews">Interviews</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/jsf" title="JSF">JSF</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/java" title="Java">Java</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/javaee" title="JavaEE">JavaEE</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/linux" title="Linux">Linux</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/maven" title="Maven">Maven</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/mybatis" title="MyBatis">MyBatis</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/primefaces" title="PrimeFaces">PrimeFaces</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/servlets-jsp" title="Servlets JSP">Servlets JSP</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/spring" title="Spring">Spring</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springboot" title="SpringBoot">SpringBoot</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springcloud" title="SpringCloud">SpringCloud</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/tips" title="Tips">Tips</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/virtualbox" title="VirtualBox">VirtualBox</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/books" title="books">books</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/jcart" title="jcart">jcart</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/jooq" title="jooq">jooq</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/microservices" title="microservices">microservices</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/rabbitmq" title="rabbitmq">rabbitmq</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springboot" title="springboot">springboot</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springcloud" title="springcloud">springcloud</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/springsession" title="springsession">springsession</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/travis-ci" title="travis-ci">travis-ci</a> <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/videos" title="videos">videos</a></div></div></aside></section></div><div id="footer" class="footer-wrap"><footer id="colophon" class="site-footer container clearfix" role="contentinfo"><div id="footer-text" class="site-info"><span class="credit-link"><a href="/" target="_blank">SivaLabs</a> Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span></div></footer></div></div></body></html>