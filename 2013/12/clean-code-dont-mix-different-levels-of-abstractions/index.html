<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    
    
    <div class="analytics">
        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-71296890-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </div>
    
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" property="title" content="SivaLabs - Clean Code: Don’t mix different levels of abstractions">
    <meta name="description" property="description" content="Java, Spring, SpringBoot, SpringCloud, JPA, Hibernate, DevOps, MicroServices, Docker tutorials - " >
    <title>SivaLabs - Clean Code: Don’t mix different levels of abstractions </title>
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Clean Code: Don’t mix different levels of abstractions"/>
<meta name="twitter:description" content="We spend more time on reading code than writing. So if the code is more readable then obviously it will increase the developer productivity.
Many people associate readability of code with coding conventions like following standard naming conventions, closing file, DB resources etc etc. When it comes to code reviews most of the people focus on these trivial things only, like checking for naming convention violations, properly releasing resources in finally block or not."/>
<meta name="twitter:site" content="@sivalabs"/>

    <meta name="twitter:creator" content="@sivalabs"/>
    <meta property="og:title" content="Clean Code: Don’t mix different levels of abstractions" />
<meta property="og:description" content="We spend more time on reading code than writing. So if the code is more readable then obviously it will increase the developer productivity.
Many people associate readability of code with coding conventions like following standard naming conventions, closing file, DB resources etc etc. When it comes to code reviews most of the people focus on these trivial things only, like checking for naming convention violations, properly releasing resources in finally block or not." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sivalabs.github.io/2013/12/clean-code-dont-mix-different-levels-of-abstractions/" />
<meta property="article:published_time" content="2013-12-29T00:53:00&#43;00:00"/>
<meta property="article:modified_time" content="2013-12-29T00:53:00&#43;00:00"/>

    
<meta itemprop="name" content="Clean Code: Don’t mix different levels of abstractions">
<meta itemprop="description" content="We spend more time on reading code than writing. So if the code is more readable then obviously it will increase the developer productivity.
Many people associate readability of code with coding conventions like following standard naming conventions, closing file, DB resources etc etc. When it comes to code reviews most of the people focus on these trivial things only, like checking for naming convention violations, properly releasing resources in finally block or not.">


<meta itemprop="datePublished" content="2013-12-29T00:53:00&#43;00:00" />
<meta itemprop="dateModified" content="2013-12-29T00:53:00&#43;00:00" />
<meta itemprop="wordCount" content="1117">



<meta itemprop="keywords" content="Best Practices,Java," />


    <link rel='stylesheet' href="/assets/css/custom-fonts.css" type='text/css' media='all'/>

    <link rel='stylesheet' href="/assets/css/style.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/genericons.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/font-awesome.min.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/socicon.css" type='text/css' media='all'/>
    <link rel="stylesheet" href="/assets/css/social-logos/social-logos.css" type="text/css" media="all">
    <link rel='stylesheet' href="/assets/css/jetpack.css" type='text/css' media='all'/>
    <link rel='stylesheet' href="/assets/css/custom-styles.css" type='text/css' media='all'/>

    <script type='text/javascript' src="/assets/js/jquery-1.12.4.min.js"></script>
    <script type='text/javascript' src="/assets/js/html5shiv.min.js"></script>
    <script type='text/javascript' src="/assets/js/navigation.js"></script>

    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    
</head>
<body class="home blog logged-in admin-bar no-customize-support post-layout-one-column">
    <div id="header-top" class="header-bar-wrap"></div>
    <div id="page" class="hfeed site">
        <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
        <header id="masthead" class="site-header clearfix" role="banner">
    <div class="header-main container clearfix">
        <div id="logo" class="site-branding clearfix">
            <h1 class="site-title">
                <a href="/" title="SivaLabs" rel="home">SivaLabs</a>
            </h1>
            <p class="site-description">My Experiments on Technology</p>
        </div>
        <div class="header-widgets clearfix">
        </div>
    </div>
    <div id="main-navigation-wrap" class="primary-navigation-wrap">
        <nav id="main-navigation" class="primary-navigation navigation container clearfix" role="navigation">
            <ul id="menu-home" class="main-navigation-menu">
                <li id="menu-item-1145" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-1145">
                    <a href="/">Home</a>
                </li>
                <li id="menu-item-1421" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1421">
                    <a href="/categories/java">Java</a>
                </li>
                <li id="menu-item-1423" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-1423">
                    <a href="/categories/spring">Spring</a>
                    <ul class="sub-menu">
                        <li id="menu-item-1424" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1424">
                            <a href="/categories/springboot">Spring Boot</a>
                        </li>
                        <li id="menu-item-1425" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1425">
                            <a href="/categories/springcloud">Spring Cloud</a>
                        </li>
                    </ul>
                </li>
                <li id="menu-item-1422" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1422">
                    <a href="/categories/microservices">MicroServices</a>
                </li>
                <li id="menu-item-1151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1151">
                    <a href="/videos">Videos</a>
                </li>
                <li id="menu-item-1161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1161">
                    <a href="/mybooks">My Books</a>
                </li>
                <li id="menu-item-1146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1146">
                    <a href="/contact">Contact</a>
                </li>
            </ul>
        </nav>
    </div>
</header>
        <div id="content" class="site-content container clearfix">
            <section id="primary" class="content-archive content-area">
                
<main id="main" class="site-main" role="main">
<article class="post type-post status-publish format-standard hentry">
    <div class="post-inner-content">
        <header class="entry-header">
    <div class="entry-meta">
        <span class="meta-date">
            <a href="https://sivalabs.github.io/2013/12/clean-code-dont-mix-different-levels-of-abstractions/" rel="bookmark">
                <time class="entry-date published" datetime="2013-12-29T00:53:00">
                December 29, 2013
                </time>
            </a>
        </span>
        <span class="meta-author">
            <span class="author vcard">Siva</span>
        </span>
    </div>
    <h2 class="entry-title">
        <a href="https://sivalabs.github.io/2013/12/clean-code-dont-mix-different-levels-of-abstractions/" rel="bookmark">
            Clean Code: Don’t mix different levels of abstractions
        </a>
    </h2>
    <div>
        
        
        
        <span class="tagcloud post-tags">
            <i class="fa fa-tags"></i>
            
            <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/best-practices/">Best Practices</a>
            &nbsp;
            
            <a class="tag-cloud-link widget__link widget__link--taglist" href="/tags/java/">Java</a>
            
            
        </span>
        
        
    </div>
</header>

        <div class="entry-content">
            <p>We spend more time on reading code than writing. So if the code is more readable then obviously it will increase the developer productivity.</p>

<p>Many people associate readability of code with coding conventions like following standard naming conventions, closing file, DB resources etc etc. When it comes to code reviews most of the people focus on these trivial things only, like checking for naming convention violations, properly releasing resources in finally block or not.</p>

<p>Do we need &#8220;Senior Resources&#8221; in team (I hate to call a human being as a Resource) to do these things?Tools like Findbugs, PMD, Checkstyle, Sonar can do that for you. I agree that following a standard naming convention by all the team members is a good thing. But that doesn&#8217;t increase the readability of code.</p>

<p>Let us take a simple example. I would like to implement Fund Transfer usecase and following are the rules to implement:</p>

<ul>
<li>Source and target accounts should be valid accounts</li>
<li>Check whether source account has sufficient amount</li>
<li>Check whether source account has provision for Overdraft and check whether this transaction exceeds the overdraft limit</li>
<li>Check for duplicate transaction with last transaction. If source, target accounts and amount is same with last transaction consider it as a duplicate transaction</li>
<li>If everything is fine then transfer amount to target account</li>
</ul>

<p>Assume we have the following implementation for the above usecase:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UglyMoneyTransferService</span> 
<span style="color:#f92672">{</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">transferFunds</span><span style="color:#f92672">(</span>Account source<span style="color:#f92672">,</span> 
	                          Account target<span style="color:#f92672">,</span> 
	                          BigDecimal amount<span style="color:#f92672">,</span> 
	                          <span style="color:#66d9ef">boolean</span> allowDuplicateTxn<span style="color:#f92672">)</span> 
	                     <span style="color:#66d9ef">throws</span> IllegalArgumentException<span style="color:#f92672">,</span> RuntimeException 
	<span style="color:#f92672">{</span>	
	Connection conn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
	<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
		conn <span style="color:#f92672">=</span> DBUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getConnection</span><span style="color:#f92672">();</span>
		PreparedStatement pstmt <span style="color:#f92672">=</span> 
		    conn<span style="color:#f92672">.</span><span style="color:#a6e22e">prepareStatement</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Select * from accounts where acno = ?&#34;</span><span style="color:#f92672">);</span>
		pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">setString</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> source<span style="color:#f92672">.</span><span style="color:#a6e22e">getAcno</span><span style="color:#f92672">());</span>
		ResultSet rs <span style="color:#f92672">=</span> pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">executeQuery</span><span style="color:#f92672">();</span>
		Account sourceAccount <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>rs<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			sourceAccount <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Account<span style="color:#f92672">();</span>
			<span style="color:#75715e">//populate account properties from ResultSet
</span><span style="color:#75715e"></span>		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>sourceAccount <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Invalid Source ACNO&#34;</span><span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		Account targetAccount <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
		pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">setString</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> target<span style="color:#f92672">.</span><span style="color:#a6e22e">getAcno</span><span style="color:#f92672">());</span>
		rs <span style="color:#f92672">=</span> pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">executeQuery</span><span style="color:#f92672">();</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>rs<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			targetAccount <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Account<span style="color:#f92672">();</span>
			<span style="color:#75715e">//populate account properties from ResultSet
</span><span style="color:#75715e"></span>		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>targetAccount <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Invalid Target ACNO&#34;</span><span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>sourceAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">isOverdraftAllowed</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span><span style="color:#f92672">((</span>sourceAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">getBalance</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> amount<span style="color:#f92672">)</span> <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Insufficient Balance&#34;</span><span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span><span style="color:#f92672">(((</span>sourceAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">getBalance</span><span style="color:#f92672">()+</span>sourceAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">getOverdraftLimit</span><span style="color:#f92672">())</span> <span style="color:#f92672">-</span> amount<span style="color:#f92672">)</span> <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
				<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Insufficient Balance, Exceeding Overdraft Limit&#34;</span><span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
		AccountTransaction lastTxn <span style="color:#f92672">=</span> <span style="color:#f92672">..</span> <span style="color:#f92672">;</span> <span style="color:#75715e">//JDBC code to obtain last transaction of sourceAccount
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>lastTxn <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>lastTxn<span style="color:#f92672">.</span><span style="color:#a6e22e">getTargetAcno</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>targetAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">getAcno</span><span style="color:#f92672">())</span> <span style="color:#f92672">&amp;&amp;</span> lastTxn<span style="color:#f92672">.</span><span style="color:#a6e22e">getAmount</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> amount <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>allowDuplicateTxn<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Duplicate transaction exception&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//ask for confirmation and proceed
</span><span style="color:#75715e"></span>			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
		sourceAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">debit</span><span style="color:#f92672">(</span>amount<span style="color:#f92672">);</span>
		targetAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">credit</span><span style="color:#f92672">(</span>amount<span style="color:#f92672">);</span>
		TransactionService<span style="color:#f92672">.</span><span style="color:#a6e22e">saveTransaction</span><span style="color:#f92672">(</span>source<span style="color:#f92672">,</span> target<span style="color:#f92672">,</span>  amount<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
		logger<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span>e<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span> 
			conn<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span> 
		<span style="color:#f92672">}</span> 
		<span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span> 
			<span style="color:#75715e">//Not everything is in your control..sometimes we have to believe in GOD/JamesGosling and proceed
</span><span style="color:#75715e"></span>		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>	
<span style="color:#f92672">}</span></code></pre></div>

<p>The above code is readable..right??&#8230;because:</p>

<ol>
<li><p>We have followed naming conventions like camel casing variable names</p></li>

<li><p>We have all the open braces ({) on the method definition line</p></li>

<li><p>We have closed DB Connection in finally block</p></li>

<li><p>we have logged exception instead of using System.err.println()</p></li>
</ol>

<p>and most important, it is working as expected.</p>

<p><em><strong>So is it readable and clean code?? In my opinion absolutely not. There are many issues in the above code from readability perspective.</strong></em></p>

<p><strong>1. Mixing DB interaction code with business logic</strong></p>

<p><strong>2. Throwing IllegalArgumentException, RuntimeException etc from business methods instead of Business specific exceptions</strong></p>

<p><strong>3. Most importantly, the code is mixed with different levels of abstractions.</strong></p>

<p>Let me explain what I mean by different levels of abstractions.</p>

<p>Firstly, from business perspective fund transfer means validating source/target accounts, checking for sufficient balance, checking for overdraft limit, checking for duplicate transaction and making the fund transfer.</p>

<p>From technical point of view there are various tasks like fetching Account details from DB, performing all the business related checks, throwing Exceptions if there are any violations, properly closing the resources etc.</p>

<p>But in the above code everything is mixed together.</p>

<p><em>While reading the code you start looking at JDBC code and your brain is working in Technical mode and after getting Account object from ResultSet you are checking for null and throwing Exception if it is null which is Business requirement. So immediately you need to switch your mind to Business mode and think &#8220;OK, if the account is invalid we want to abort the operation immediately&#8221;.</em></p>

<p><em>Though you managed to switch between Technical and Business modes, what about making an enhancement to one particular subtask like &#8220;Fund transfer is considred duplicate only if it matches with the last transaction that happened with in an hour only&#8221;. To make that enhancement you have to go through the entire method because you haven&#8217;t modularised your sub-tasks and there is no separation of concerns.</em></p>

<p>Lets rewrite the above method as follows:</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FundTransferTxn</span>
<span style="color:#f92672">{</span>
	<span style="color:#66d9ef">private</span> Account sourceAccount<span style="color:#f92672">;</span> 
	<span style="color:#66d9ef">private</span> Account targetAccount<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">private</span> BigDecimal amount<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> allowDuplicateTxn<span style="color:#f92672">;</span>
	<span style="color:#75715e">//setters &amp; getters
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CleanMoneyTransferService</span> 
<span style="color:#f92672">{</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">transferFunds</span><span style="color:#f92672">(</span>FundTransferTxn txn<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		Account sourceAccount <span style="color:#f92672">=</span> validateAndGetAccount<span style="color:#f92672">(</span>txn<span style="color:#f92672">.</span><span style="color:#a6e22e">getSourceAccount</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAcno</span><span style="color:#f92672">());</span>
		Account targetAccount <span style="color:#f92672">=</span> validateAndGetAccount<span style="color:#f92672">(</span>txn<span style="color:#f92672">.</span><span style="color:#a6e22e">getTargetAccount</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAcno</span><span style="color:#f92672">());</span>
		checkForOverdraft<span style="color:#f92672">(</span>sourceAccount<span style="color:#f92672">,</span> txn<span style="color:#f92672">.</span><span style="color:#a6e22e">getAmount</span><span style="color:#f92672">());</span>
		checkForDuplicateTransaction<span style="color:#f92672">(</span>txn<span style="color:#f92672">);</span>
		makeTransfer<span style="color:#f92672">(</span>sourceAccount<span style="color:#f92672">,</span> targetAccount<span style="color:#f92672">,</span> txn<span style="color:#f92672">.</span><span style="color:#a6e22e">getAmount</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
	
	<span style="color:#66d9ef">private</span> Account <span style="color:#a6e22e">validateAndGetAccount</span><span style="color:#f92672">(</span>String acno<span style="color:#f92672">){</span>
		Account account <span style="color:#f92672">=</span> AccountDAO<span style="color:#f92672">.</span><span style="color:#a6e22e">getAccount</span><span style="color:#f92672">(</span>acno<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>account <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidAccountException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Invalid ACNO :&#34;</span><span style="color:#f92672">+</span>acno<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">return</span> account<span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
	
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">checkForOverdraft</span><span style="color:#f92672">(</span>Account account<span style="color:#f92672">,</span> BigDecimal amount<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">isOverdraftAllowed</span><span style="color:#f92672">()){</span>
			<span style="color:#66d9ef">if</span><span style="color:#f92672">((</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">getBalance</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> amount<span style="color:#f92672">)</span> <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span>	<span style="color:#f92672">{</span>
				<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InsufficientBalanceException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Insufficient Balance&#34;</span><span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span><span style="color:#f92672">(((</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">getBalance</span><span style="color:#f92672">()+</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">getOverdraftLimit</span><span style="color:#f92672">())</span> <span style="color:#f92672">-</span> amount<span style="color:#f92672">)</span> <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">){</span>
				<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ExceedingOverdraftLimitException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Insufficient Balance, Exceeding Overdraft Limit&#34;</span><span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
	
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">checkForDuplicateTransaction</span><span style="color:#f92672">(</span>FundTransferTxn txn<span style="color:#f92672">){</span>
		AccountTransaction lastTxn <span style="color:#f92672">=</span> TransactionDAO<span style="color:#f92672">.</span><span style="color:#a6e22e">getLastTransaction</span><span style="color:#f92672">(</span>txn<span style="color:#f92672">.</span><span style="color:#a6e22e">getSourceAccount</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAcno</span><span style="color:#f92672">());</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>lastTxn <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>	<span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>lastTxn<span style="color:#f92672">.</span><span style="color:#a6e22e">getTargetAcno</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>txn<span style="color:#f92672">.</span><span style="color:#a6e22e">getTargetAccount</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAcno</span><span style="color:#f92672">())</span> 
					<span style="color:#f92672">&amp;&amp;</span> lastTxn<span style="color:#f92672">.</span><span style="color:#a6e22e">getAmount</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> txn<span style="color:#f92672">.</span><span style="color:#a6e22e">getAmount</span><span style="color:#f92672">()</span> 
					<span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>txn<span style="color:#f92672">.</span><span style="color:#a6e22e">isAllowDuplicateTxn</span><span style="color:#f92672">())</span>	<span style="color:#f92672">{</span>
				<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> DuplicateTransactionException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Duplicate transaction exception&#34;</span><span style="color:#f92672">);</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
	
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">makeTransfer</span><span style="color:#f92672">(</span>Account source<span style="color:#f92672">,</span> Account target<span style="color:#f92672">,</span> BigDecimal amount<span style="color:#f92672">){</span>
		sourceAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">debit</span><span style="color:#f92672">(</span>amount<span style="color:#f92672">);</span>
		targetAccount<span style="color:#f92672">.</span><span style="color:#a6e22e">credit</span><span style="color:#f92672">(</span>amount<span style="color:#f92672">);</span>
		TransactionService<span style="color:#f92672">.</span><span style="color:#a6e22e">saveTransaction</span><span style="color:#f92672">(</span>source<span style="color:#f92672">,</span> target<span style="color:#f92672">,</span>  amount<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>	
<span style="color:#f92672">}</span></code></pre></div>
The above improved method do exactly what the initial verson is doing but now it looks lot better than earlier version.</p>

<ul>
<li>We have divided the entire task into sub-tasks and implemented each sub-task in a separate method.</li>
<li>We have delegated DB interactions to DAOs</li>
<li>We are throwing Business specific Exceptions instead of Java language Exceptions</li>
<li>All in all we have separated the levels of abstractions.</li>
</ul>

<p><em>At the first level we have highest level of abstraction in transferFunds(FundTransferTxn txn) method. By looking at this method we can understand what we are doing as part of Fund Transfer operation without worrying much about implementation or technical details.</em></p>

<p>_<em>At the second level we have business logic implementation methods checkForOverdraft, checkForDuplicateTransaction etc which performs business logic, again without worrying much about technical details.</em></p>

<p>_<em>At the lowest level we have technical implementation details in AccountDAO and TransactionDAO which contains DB interaction logic.</em></p>

<p>So the reader(future developer/maintainer) of your code can easily understand what you are doing at the high level and can dig into method which he is interested in.</p>

<p>As I said earlier, if we have to make the change to consider the transaction as a duplicate transaction only if it happened with in an hour, we can easily understand that checkForDuplicateTransaction() is the one we have to look into and make change.</p>

<p>Happy coding!!</p>

        </div>
        <div class="sharedaddy sd-sharing-enabled">
    <div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing">
        <h3 class="sd-title">Share this:</h3>
        <div class="sd-content">
            <ul>
                <li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-1144" class="share-twitter sd-button share-icon no-text" href="https://twitter.com/intent/tweet?status=Clean%20Code%3a%20Don%e2%80%99t%20mix%20different%20levels%20of%20abstractions-https%3a%2f%2fsivalabs.github.io%2f2013%2f12%2fclean-code-dont-mix-different-levels-of-abstractions%2f" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li>
                <li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-1144" class="share-facebook sd-button share-icon no-text" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsivalabs.github.io%2f2013%2f12%2fclean-code-dont-mix-different-levels-of-abstractions%2f" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li>
                <li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-1144" class="share-google-plus-1 sd-button share-icon no-text" href="https://plus.google.com/share?url=https%3a%2f%2fsivalabs.github.io%2f2013%2f12%2fclean-code-dont-mix-different-levels-of-abstractions%2f" target="_blank" title="Click to share on Google+"><span></span><span class="sharing-screen-reader-text">Click to share on Google+ (Opens in new window)</span></a></li>
                <li class="share-reddit"><a rel="nofollow" data-shared="" class="share-reddit sd-button share-icon no-text" href="http://www.reddit.com/submit?url=https%3a%2f%2fsivalabs.github.io%2f2013%2f12%2fclean-code-dont-mix-different-levels-of-abstractions%2f&title=Clean%20Code%3a%20Don%e2%80%99t%20mix%20different%20levels%20of%20abstractions" target="_blank" title="Click to share on Reddit"><span></span><span class="sharing-screen-reader-text">Click to share on Reddit (Opens in new window)</span></a></li>
                <li class="share-linkedin"><a rel="nofollow" data-shared="sharing-linkedin-1144" class="share-linkedin sd-button share-icon no-text" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsivalabs.github.io%2f2013%2f12%2fclean-code-dont-mix-different-levels-of-abstractions%2f&title=Clean%20Code%3a%20Don%e2%80%99t%20mix%20different%20levels%20of%20abstractions" target="_blank" title="Click to share on LinkedIn"><span></span><span class="sharing-screen-reader-text">Click to share on LinkedIn (Opens in new window)</span></a></li>
                <li class="share-end"></li>
            </ul>
        </div>
    </div>
</div>

    </div>
</article>


<div class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "sivalabs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>



<nav class="navigation post-navigation" role="navigation">
	<h2 class="screen-reader-text">Post navigation</h2>
	<div class="nav-links">
		<div class="nav-previous">
			<a href="/2014/10/netbeanside-and-intellijidea-from-eyes/" rel="next">
				<i class="fa fa-chevron-left"></i>
				<span class="post-title">NetBeansIDE and IntellijIDEA From The Eyes of a Long Time Eclipse User</span>
			</a>
		</div>
		<div class="nav-next">
			<a href="/2013/11/primefaces-beginners-guide-book-published/" rel="prev">
                <span class="post-title">PrimeFaces Beginner’s Guide book published
                    <i class="fa fa-chevron-right"></i>
                </span>
			</a>
		</div>
	</div>
</nav>

</main>

            </section>

            <section id="secondary" class="sidebar widget-area clearfix" role="complementary">
                
<aside id="zoom-social-icons-widget-2" class="widget zoom-social-icons-widget">
    <h3 class="widget-title">Follow Me</h3>

    <ul class="zoom-social-icons-list zoom-social-icons-list--with-canvas zoom-social-icons-list--rounded zoom-social-icons-list--no-labels">

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="https://github.com/sivaprasadreddy"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-github"
                          data-hover-rule="background-color" data-hover-color="#221e1b"

                    ></span>
            </a>
        </li>
        

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="https://twitter.com/sivalabs"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-twitter"
                          data-hover-rule="background-color" data-hover-color="#55acee"
                    ></span>
            </a>
        </li>
        

        

        

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="https://in.linkedin.com/in/siva-prasad-reddy-k-3a909172"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-linkedin"
                          data-hover-rule="background-color" data-hover-color="#3371b7"
                    ></span>
            </a>
        </li>

        

        
        <li class="zoom-social_icons-list__item">
            <a class="zoom-social_icons-list__link"
               href="http://www.youtube.com/c/SivaPrasadReddy%20"
               target="_blank">
                    <span class="zoom-social_icons-list-span socicon socicon-youtube"
                          data-hover-rule="background-color" data-hover-color="#e02a20"
                    ></span>
            </a>
        </li>
        
    </ul>
</aside>



<aside id="recent-posts-2" class="widget widget_recent_entries clearfix">
    <div class="widget-header">
        <h3 class="widget-title">Recent Posts</h3>
    </div>
    <ul>
        <li class="widget__item"><a class="widget__link" href="/2018/03/microservices-part-6-distributed-tracing-with-spring-cloud-sleuth-and-zipkin/">MicroServices - Part 6 : Distributed Tracing with Spring Cloud Sleuth and Zipkin</a></li>
        <li class="widget__item"><a class="widget__link" href="/2018/03/microservices-part-5-spring-cloud-zuul-proxy-as-api-gateway/">MicroServices - Part 5 : Spring Cloud Zuul Proxy as API Gateway</a></li>
        <li class="widget__item"><a class="widget__link" href="/2018/03/spring-cloud-netflix-circuit-breaker/">MicroServices - Part 4 : Spring Cloud Circuit Breaker using Netflix Hystrix</a></li>
        <li class="widget__item"><a class="widget__link" href="/2018/03/microservices-springcloud-eureka/">MicroServices - Part 3 : Spring Cloud Service Registry and Discovery</a></li>
        <li class="widget__item"><a class="widget__link" href="/2018/03/microservices-part-2-configuration-management-spring-cloud-config-vault/">MicroServices - Part 2 : Configuration Management with Spring Cloud Config and Vault</a></li>
    </ul>

</aside>

<aside id="top-posts-2" class="widget widget_top-posts clearfix">
    <div class="widget-header"><h3 class="widget-title">Top Posts &amp; Pages</h3></div>
    <ul>

        <li>
            <a href="/2016/03/why-springboot/"
            class="bump-view" data-bump-view="tp">
            Why SpringBoot?</a>
        </li>

        <li>
            <a href="/2016/03/how-springboot-autoconfiguration-magic/"
            class="bump-view" data-bump-view="tp">
            How SpringBoot AutoConfiguration magic works?</a>
        </li>

        <li>
            <a href="/2015/11/developing-a-simple-e-commerce-application-from-scratch-to-production-using-springboot/"
            class="bump-view" data-bump-view="tp">
            Developing a simple e-commerce application from scratch to production using SpringBoot</a>
        </li>

        <li>
            <a href="/2013/12/clean-code-dont-mix-different-levels-of-abstractions/"
            class="bump-view" data-bump-view="tp">
            Clean Code: Don’t mix different levels of abstractions</a>
        </li>

        <li>
            <a href="/2015/06/a-developers-perspective-on-spring-vs-javaee/"
            class="bump-view" data-bump-view="tp">
            A Developers Perspective on Spring vs JavaEE</a>
        </li>

        <li>
            <a href="/2015/07/my-life-as-software-developer-in-india/"
            class="bump-view" data-bump-view="tp">
            My Life as a Software Developer in India</a>
        </li>

        <li>
            <a href="/2011/01/10-things-to-become-outstanding-java/"
            class="bump-view" data-bump-view="tp">
            10 things to become an outstanding Java developer</a>
        </li>
</ul>
</aside>

<aside id="categories-2" class="widget widget_categories clearfix">
    <div class="widget-header"><h3 class="widget-title">Categories</h3></div>
    <ul>
        <li class="cat-item"><a href="/categories/best-practices">Best Practices</a></li>
        <li class="cat-item"><a href="/categories/blog">Blog</a></li>
        <li class="cat-item"><a href="/categories/books">Books</a></li>
        <li class="cat-item"><a href="/categories/ide">IDE</a></li>
        <li class="cat-item"><a href="/categories/java">Java</a></li>
        <li class="cat-item"><a href="/categories/javaee">JavaEE</a></li>
        <li class="cat-item"><a href="/categories/linux">Linux</a></li>
        <li class="cat-item"><a href="/categories/misc">Misc</a></li>
        <li class="cat-item"><a href="/categories/spring">Spring</a></li>
        <li class="cat-item"><a href="/categories/tips">Tips</a></li>
        <li class="cat-item"><a href="/categories/books">Books</a></li>
        <li class="cat-item"><a href="/categories/microservices">Microservices</a></li>
        <li class="cat-item"><a href="/categories/springboot">Springboot</a></li>
        <li class="cat-item"><a href="/categories/springcloud">Springcloud</a></li>
        <li class="cat-item"><a href="/categories/travis-ci">Travis-Ci</a></li>
        <li class="cat-item"><a href="/categories/videos">Videos</a></li>
    </ul>
</aside>


<aside id="tag_cloud-3" class="widget widget_tag_cloud clearfix">
    <div class="widget-header"><h3 class="widget-title">Tags</h3></div>
    <div class="tagcloud">

        <div class="widget__content">
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/android" title="Android">Android</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/best-practices" title="Best Practices">Best Practices</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/blog" title="Blog">Blog</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/blogging" title="Blogging">Blogging</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/books" title="Books">Books</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/e-commerce" title="E-Commerce">E-Commerce</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/ide" title="IDE">IDE</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/it" title="IT">IT</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/interviews" title="Interviews">Interviews</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/jsf" title="JSF">JSF</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/java" title="Java">Java</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/javaee" title="JavaEE">JavaEE</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/linux" title="Linux">Linux</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/maven" title="Maven">Maven</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/mybatis" title="MyBatis">MyBatis</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/primefaces" title="PrimeFaces">PrimeFaces</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/servlets-jsp" title="Servlets JSP">Servlets JSP</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/spring" title="Spring">Spring</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springboot" title="SpringBoot">SpringBoot</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springcloud" title="SpringCloud">SpringCloud</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/tips" title="Tips">Tips</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/virtualbox" title="VirtualBox">VirtualBox</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/books" title="books">books</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/jcart" title="jcart">jcart</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/jooq" title="jooq">jooq</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/microservices" title="microservices">microservices</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/rabbitmq" title="rabbitmq">rabbitmq</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springboot" title="springboot">springboot</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springcloud" title="springcloud">springcloud</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/springsession" title="springsession">springsession</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/travis-ci" title="travis-ci">travis-ci</a>
            <a class="tag-cloud-link widget__link widget__link--taglist"
               href="/tags/videos" title="videos">videos</a>
        </div>
    </div>
</aside>
            </section>
        </div>
        <div id="footer" class="footer-wrap">
            <footer id="colophon" class="site-footer container clearfix" role="contentinfo">
    <div id="footer-text" class="site-info">
        <span class="credit-link">
            <a href="/" target="_blank">SivaLabs</a>
            Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
        </span>
    </div>
</footer>

        </div>
    </div>

</body>
</html>
